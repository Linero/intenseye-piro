(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{100:function(e,t,n){e.exports=n(195)},105:function(e,t,n){},111:function(e,t){},113:function(e,t){},145:function(e,t){},146:function(e,t){},193:function(e,t,n){},194:function(e,t,n){},195:function(e,t,n){"use strict";n.r(t);var a=n(6),r=n.n(a),c=n(97),o=n.n(c),i=(n(105),n(13)),s=n.n(i),l=n(32),u=n(17),d=n(15),m=n(98),h=n(19),p=n(18),f=n(20),w=n(31),v=n(99),b=n.n(v),g=n(33),j=n(22),y=function e(t){var n=this;Object(d.a)(this,e),this.loadModel=function(){return j.c(n.modelPath).then(function(e){n.model=e,console.log("Loaded model with shape: ".concat(e.input.shape))}).catch(console.log)},this.modelPath=t},E=function(e){function t(){var e;return Object(d.a)(this,t),(e=Object(h.a)(this,Object(p.a)(t).call(this,"https://s3.amazonaws.com/intenseye-workshop/face_detector"))).loadModel=function(){return g.d.tinyFaceDetector.load(e.modelPath)},e.detectFace=function(e){return g.b(e,new g.a).then(function(t){return g.c(e,t)})},e}return Object(f.a)(t,e),t}(y),O=function(e,t){var n=j.a.fromPixels(e),a=Object(l.a)(n.shape,2),r=a[0],c=a[1];return r===t&&c===t?n:j.b.resizeBilinear(n,[t,t],!0)},k=function(){var e=Object(u.a)(s.a.mark(function e(t){var n,a,r,c,o,i,u,d,m;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.min(),a=t.max(),e.next=4,Promise.all([n.data(),a.data()]);case 4:return r=e.sent,c=r.map(function(e){return e[0]}),o=Object(l.a)(c,2),i=o[0],u=o[1],n.dispose(),a.dispose(),d=t.sub(j.d(i)).div(j.d(u-i)),m=d.mean(2),e.abrupt("return",m.expandDims(2));case 11:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),x=function(e){function t(){var e;return Object(d.a)(this,t),(e=Object(h.a)(this,Object(p.a)(t).call(this,"https://s3.amazonaws.com/intenseye-workshop/emotion/model.json"))).emotions={0:"Angry",1:"Disgusted",2:"Fearful",3:"Happy",4:"Sad",5:"Surprised",6:"Neutral"},e.predict=function(){var t=Object(u.a)(s.a.mark(function t(n){var a,r,c,o,i,l;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a=O(n,48),t.next=3,k(a);case 3:return r=t.sent,c=r.reshape([1,48,48,1]),o=e.model.predict(c),t.next=8,o.data();case 8:return i=t.sent,l=[],i.forEach(function(t,n){return l.push({label:e.emotions[n],value:t})}),t.abrupt("return",l);case 12:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),e}return Object(f.a)(t,e),t}(y),D=function(e){function t(){var e;return Object(d.a)(this,t),(e=Object(h.a)(this,Object(p.a)(t).call(this,"https://s3.amazonaws.com/intenseye-workshop/age_gender2/model.json"))).predict=function(){var t=Object(u.a)(s.a.mark(function t(n){var a,r,c,o;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a=O(n,64),t.next=3,k(a);case 3:return r=t.sent,c=r.reshape([1,64,64,1]),o=e.model.predict(c),t.abrupt("return",o.data());case 7:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),e}return Object(f.a)(t,e),t}(y),A=(n(193),n(194),function(e){var t=e.label,n=e.value;return r.a.createElement("div",{className:"result"},r.a.createElement("span",{className:"result__label"},t),r.a.createElement("div",{style:{width:n>.01?150*n:0},className:"result__value"}))}),M=function(e){function t(){var e,n;Object(d.a)(this,t);for(var a=arguments.length,c=new Array(a),o=0;o<a;o++)c[o]=arguments[o];return(n=Object(h.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(c)))).faceDetector=new E,n.emotionDetector=new x,n.ageGenderDetector=new D,n.webcam=r.a.createRef(),n.canvas=r.a.createRef(),n.timer=0,n.newLink="images/man/0.jpg",n.startTimer=n.startTimer.bind(Object(w.a)(Object(w.a)(n))),n.state={emotionPredictions:[],gender:null,modelsLoaded:!1,webcamAllowed:null,counter:10,link:"images/man/0.jpg",adIndex:0},n.delay=function(e){return new Promise(function(t){return setTimeout(t,e)})},n.connectToWebcam=function(){if(navigator.mediaDevices.getUserMedia)return navigator.mediaDevices.getUserMedia({video:!0}).then(function(e){n.webcam.current.srcObject=e,n.setState({webcamAllowed:!0})}).catch(function(e){throw console.log(e),n.setState({webcamAllowed:!1}),new Error("webc")})},n.detectFace=Object(u.a)(s.a.mark(function e(){var t,a,r,c,o,i;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.faceDetector.detectFace(n.webcam.current);case 3:if(!((t=e.sent).length>0)){e.next=19;break}return e.next=7,n.emotionDetector.predict(t[0]);case 7:return a=e.sent,e.next=10,n.ageGenderDetector.predict(t[0]);case 10:if(r=e.sent,c=Object(l.a)(r,1),o=c[0],null!=a&&n.setState({emotionPredictions:a}),null==o){e.next=19;break}if(!(o>.4&&o<.6)){e.next=17;break}return e.abrupt("return",n.detectFace());case 17:i=o<.5?"Male":"Female",n.setState({gender:i});case 19:return e.abrupt("return",n.detectFace());case 22:return e.prev=22,e.t0=e.catch(0),console.log(e.t0),e.abrupt("return",null);case 26:case"end":return e.stop()}},e,null,[[0,22]])})),n.renderApp=function(e){return n.state.webcamAllowed?r.a.createElement("div",{className:"result-wrapper"},n.state.gender&&r.a.createElement("div",null,r.a.createElement("span",null,"Gender: "),r.a.createElement("span",{style:{color:e}},n.state.gender)),n.state.emotionPredictions.map(function(e){var t=e.label,n=e.value;return r.a.createElement(A,{key:t,label:t,value:n})})):null},n}return Object(f.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){var e=this;Promise.all([this.faceDetector.loadModel(),this.emotionDetector.loadModel(),this.ageGenderDetector.loadModel()]).then(function(){return e.setState({modelsLoaded:!0})}).then(this.connectToWebcam).then(function(){return e.delay(1e3)}).then(b.a.throttle(this.detectFace,50)).catch(console.log),this.adDisplay()}},{key:"componentWillUnmount",value:function(){clearInterval(this.interval),clearInterval(this.timer)}},{key:"adDisplay",value:function(){var e=this;this.timer=setInterval(function(){var t=Math.floor(5*Math.random()),n=e.state.counter-1;n<=0&&(n=10,"Male"===e.state.gender?(e.newLink="images/man/"+t+".jpg",e.adIndex=t,e.setState({link:e.newLink,adIndex:t})):"Female"===e.state.gender&&(e.newLink="images/woman/"+t+".jpg",e.setState({link:e.newLink,adIndex:t}))),e.setState({counter:n})},1e3)}},{key:"render",value:function(){var e="Male"===this.state.gender?"#00a8ff":"#e056fd";return r.a.createElement("div",{className:"App"},r.a.createElement("div",{className:"App-container"},!1===this.state.webcamAllowed&&r.a.createElement("h4",{style:{color:"#EA2027"}},"allow webcam access..."),r.a.createElement("h2",{style:{color:"orange"}},"PIRO - Emotion & Gender"),r.a.createElement("div",{id:"container"},this.state.modelsLoaded?r.a.createElement("video",{autoPlay:!0,width:640,height:480,ref:this.webcam,id:"videoElement"}):r.a.createElement("span",null,"Downloading models..."),this.renderApp(e)),r.a.createElement("div",null,this.state.webcamAllowed?r.a.createElement("div",null,r.a.createElement("div",null,r.a.createElement("p",{style:{display:"inline"}},"Time: ",this.state.counter," AD nr: ",this.state.adIndex," next for: "),r.a.createElement("p",{style:{color:e,display:"inline"}},this.state.gender)),r.a.createElement("div",null,r.a.createElement("img",{src:this.state.link,alt:"",width:"1000"}))):"")))}}]),t}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(M,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[100,1,2]]]);
//# sourceMappingURL=main.fb8631b7.chunk.js.map